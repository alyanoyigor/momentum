(()=>{"use strict";const t=document.querySelector(".greeting"),e=document.querySelector(".name"),a=document.querySelector(".lang__ru"),i=document.querySelector(".lang__eng"),s={ru:["Доброе утро","Добрый день","Добрый вечер","Доброй ночи"],eng:["morning","afternoon","evening","night"]};function n(t="eng"){const e=(new Date).getHours();return e>=6&&e<12?s[t][0]:e>=12&&e<18?s[t][1]:e>=18&&e<=23?s[t][2]:s[t][3]}function o(s){const o=n(s);"eng"===s?(t.textContent=`Good ${o},`,e.placeholder="[Enter your name]",a.classList.remove("lang__active"),i.classList.add("lang__active")):(t.textContent=o+",",e.placeholder="[Введите ваше имя]",i.classList.remove("lang__active"),a.classList.add("lang__active"))}class r{constructor(t){this.path=t,this.randomNum=this.getRandomNum(20,1),this.timeOfDay=n()}getRandomNum(t,e){return Math.floor(Math.random()*t)+e}toStringRandomNum(){let t=String(this.randomNum);return 1===t.length&&(t=t.padStart(2,"0")),t}async setBg(){const t=new Image;if("github"===this.path){const e=this.toStringRandomNum();t.src=`https://raw.githubusercontent.com/rolling-scopes-school/stage1-tasks/assets/images/${this.timeOfDay}/${e}.jpg`}else"unsplash"===this.path?t.src=await this.getUnsplashLinkToImage():"flickr"===this.path&&(t.src=await this.getFlickrLinkToImage());t.onload=()=>{document.querySelector("body").style.backgroundImage=`url(${t.src})`}}async getUnsplashLinkToImage(){const t=`https://api.unsplash.com/photos/random?orientation=landscape&query=${this.timeOfDay}&client_id=1r8k1JvSurZdF_odh5KhxL4qN0qv9WFMx_RkMz7y5jE`,e=await fetch(t);return(await e.json()).urls.regular}async getFlickrLinkToImage(){const t=`https://www.flickr.com/services/rest/?method=flickr.photos.search&api_key=181e4595d9f6aef7aca2a1a893c84d3a&tags=${this.timeOfDay}&extras=url_l&format=json&nojsoncallback=${this.randomNum}`,e=await fetch(t);return(await e.json()).photos.photo[this.randomNum].url_l}getSlideNext(){this.randomNum++,this.randomNum>20&&(this.randomNum=1),this.setBg()}getSlidePrev(){this.randomNum--,this.randomNum<1&&(this.randomNum=20),this.setBg()}}class l{constructor(t){this.text=t,this.isDone=!1,this.div=null}createIn(t){this.div=document.createElement("div"),this.div.classList.add("task");let e=document.createElement("input");e.addEventListener("click",(()=>this.changeState(this.div))),e.type="checkbox";let a=document.createElement("p");a.innerText=this.text;let i=document.createElement("button");i.classList.add("remove-button"),i.addEventListener("click",this.removeTask),this.div.append(e),this.div.append(a),this.div.append(i),this.isDone&&(this.div.classList.add("completed"),e.checked=!0),t.append(this.div)}removeTask(t){t.target.parentElement.remove(),1===document.querySelector(".task-list").children.length&&(document.querySelector("#start-message").hidden=!1)}changeState(t){this.isDone=!this.isDone,t.classList.toggle("completed")}}const c=document.querySelector(".time"),u=document.querySelector(".date"),d=document.querySelector(".quote"),m=document.querySelector(".author"),h=document.querySelector(".change-quote"),g=document.querySelector(".name"),y=document.querySelector(".slide-prev"),p=document.querySelector(".slide-next"),v=document.querySelector(".weather-icon"),S=document.querySelector(".temperature"),L=document.querySelector(".weather-description"),f=document.querySelector(".city"),q=document.querySelector(".weather-error"),_=document.querySelector(".wind"),k=document.querySelector(".humidity"),x=document.querySelector(".play"),w=document.querySelector(".play-prev"),E=document.querySelector(".play-next"),b=document.querySelector(".play-list"),N=document.querySelector(".volume-duration"),I=document.querySelector(".player-duration"),C=document.querySelector(".volume-button"),A=document.querySelector(".lang__ru"),D=document.querySelector(".lang__eng"),P=document.querySelector("#task-name-input"),$=document.querySelector("#start-message"),T=document.querySelector(".task-list"),V=document.querySelector(".settings__button"),M=document.querySelector(".settings__panel"),j=document.querySelectorAll(".path-image"),B=["time","date","greeting-container","quote-container","weather","audio-player","todo-list"],R=[];let F,O="eng",W="github";localStorage.getItem("city")&&(f.value=localStorage.getItem("city")),localStorage.getItem("name")&&(g.value=localStorage.getItem("name")),localStorage.getItem("lang")&&(O=localStorage.getItem("lang").toLowerCase()),localStorage.getItem("checkbox-state")&&(F=localStorage.getItem("checkbox-state").split(",")),localStorage.getItem("path-img")&&(W=localStorage.getItem("path-img")),window.addEventListener("beforeunload",(function(){localStorage.setItem("name",g.value),localStorage.setItem("city",f.value),localStorage.setItem("lang",document.querySelector(".lang__active").textContent),localStorage.setItem("checkbox-state",function(){const t=[];return tt.forEach((e=>{t.push(e.checked)})),t}()),localStorage.setItem("path-img",W)}));let H=new r(W);H.setBg();const U=new class{constructor(t){this.currentSong=document.querySelector(".current-song"),this.volumeDuration=document.querySelector(".volume-duration"),this.playBtn=document.querySelector(".play"),this.playListItem=document.querySelector(".play-list"),this.playerDuration=document.querySelector(".player-duration"),this.audioVolume=document.querySelector(".volume-button"),this.playList=t,this.audio=new Audio,this.isPlay=!1,this.playNum=0,this.allTracks,this.audioCurrentTime=0}initAudioPlayer(){this.audio.src=this.playList[this.playNum].src,this.currentSong.textContent=this.playList[this.playNum].title,this.audio.currentTime=0}getAudio(){return this.audio}playAudio(){this.isPlay=!this.isPlay,this.audio.play(),this.playBtn.classList.add("pause")}pauseAudio(){this.isPlay=!this.isPlay,this.audio.pause(),this.playBtn.classList.remove("pause")}playAndPause(){this.audio.src=this.playList[this.playNum].src,this.audio.currentTime=this.audioCurrentTime,this.isPlay?this.pauseAudio():this.playAudio()}playNext(){this.audioCurrentTime=0,this.playNum++,this.playNum>this.playList.length-1&&(this.playNum=0),this.audio.src=this.playList[this.playNum].src,this.currentSong.textContent=this.playList[this.playNum].title,this.isPlay=!1,this.playAndPause(),this.deleteAllActiveElements(),this.playListItem.children[this.playNum].classList.add("item-active")}playPrev(){this.audioCurrentTime=0,this.playNum--,this.playNum<0&&(this.playNum=this.playList.length-1),this.audio.src=this.playList[this.playNum].src,this.currentSong.textContent=this.playList[this.playNum].title,this.isPlay=!1,this.playAndPause(),this.deleteAllActiveElements(),this.playListItem.children[this.playNum].classList.add("item-active")}createPlayList(){this.playList.forEach(((t,e)=>{const a=document.createElement("li");a.classList.add("play-item"),a.setAttribute("data-src",t.src),a.setAttribute("data-index",e),a.textContent=t.title,this.playListItem.append(a)})),this.playListItem.children[0].classList.add("item-active")}deleteAllActiveElements(){document.querySelectorAll(".item-active").forEach((t=>t.classList.remove("item-active")))}getParticularTrack(t){this.audio.src=t.target.dataset.src,this.playNum=t.target.dataset.index,this.currentSong.textContent=this.playList[this.playNum].title,this.deleteAllActiveElements(),this.isPlay=!1,this.playAudio(),t.target.classList.add("item-active")}updateProgressValue(){this.playerDuration.max=this.audio.duration,this.playerDuration.value=this.audio.currentTime;const t=100*this.playerDuration.value/this.playerDuration.max;this.audioCurrentTime=this.audio.currentTime,document.querySelector(".player__time-current").textContent=this.formatTime(Math.floor(this.audio.currentTime)),document.querySelector(".player__time-length").textContent=this.playList[this.playNum].duration,this.playerDuration.style.background=`linear-gradient(to right, #c5b358 0%, #c5b358 ${t}%, #c4c4c4 ${t}%, #c4c4c4 100%)`}formatTime(t){let e=Math.floor(t/60),a=Math.floor(t-60*e);return a<10&&(a=`0${a}`),`0${e}:${a}`}changeProgress(){this.audio.currentTime=this.playerDuration.value}muteAudioVolume(){if(this.audio.volume<=0&&this.audio.muted)return this.volumeDuration.value=.5,this.changeVolumeDuration();this.audio.muted=!this.audio.muted,this.audio.muted?(this.audioVolume.classList.remove("volume-button_on"),this.audioVolume.classList.add("volume-button_off")):(this.audioVolume.classList.remove("volume-button_off"),this.audioVolume.classList.add("volume-button_on"))}changeVolumeDuration(){this.audio.volume=this.volumeDuration.value,this.audio.volume<=0?(this.audio.muted=!0,this.audioVolume.classList.remove("volume-button_on"),this.audioVolume.classList.add("volume-button_off")):(this.audio.muted=!1,this.audioVolume.classList.remove("volume-button_off"),this.audioVolume.classList.add("volume-button_on"));let t=this.volumeDuration.value.slice(2);"1"===this.volumeDuration.value?t=this.volumeDuration.value+"00":"0"===this.volumeDuration.value?t=this.volumeDuration.value:1===t.length&&(t+="0"),this.volumeDuration.style.background=`linear-gradient(to right, #c5b358 0%, #c5b358 ${t}%, #c4c4c4 ${t}%, #c4c4c4 100%)`}}([{title:"Aqua Caelestis",src:"./assets/sounds/Aqua Caelestis.mp3",duration:"00:39"},{title:"Ennio Morricone",src:"./assets/sounds/Ennio Morricone.mp3",duration:"01:37"},{title:"River Flows In You",src:"./assets/sounds/River Flows In You.mp3",duration:"01:37"},{title:"Summer Wind",src:"./assets/sounds/Summer Wind.mp3",duration:"01:50"}]),Y=U.getAudio();U.initAudioPlayer(),U.createPlayList(),setInterval((()=>{U.updateProgressValue()}),100);let z=setInterval((()=>J(O)),100),G=setInterval((()=>o(O)),100);function J(t){const e=new Date;let a;if("eng"===t)a=e.toLocaleTimeString();else{let t=e.getHours(),i=e.getMinutes(),s=e.getSeconds();1===String(t).length&&(t="0"+t),1===String(i).length&&(i="0"+i),1===String(s).length&&(s="0"+s),a=`${t}:${i}:${s}`}c.textContent=a,function(t){const e=new Date,a={weekday:"long",month:"long",day:"numeric"};let i;i="eng"===t?e.toLocaleDateString(void 0,a):e.toLocaleDateString("ru-RU",a),u.textContent=i}(t)}async function K(t){let e;e="eng"===t?"./js/data-eng.json":"./js/data-ru.json";const a=await fetch(e),i=await a.json(),s=Math.floor(Math.random()*i.length);d.textContent=i[s].text,m.textContent=i[s].author}function Z(t="eng"){return"eng"===t?["en","Wind","Humidity"]:["ru","Ветер","Влажность"]}async function Q(t,e){const a=`https://api.openweathermap.org/data/2.5/weather?q=${t}&lang=${e[0]}&appid=1d9d34116d918641ffb5de242fec641f&units=metric`,i=await fetch(a),s=await i.json();v.className="weather-icon owf";const n=[S,L,_,k];try{q.textContent="",v.classList.add(`owf-${s.weather[0].id}`),S.textContent=`${Math.round(s.main.temp)}°C`,L.textContent=s.weather[0].description,_.textContent=`${e[1]} - ${Math.round(s.wind.speed)} m/s`,k.textContent=`${e[2]} - ${Math.round(s.main.humidity)}%`}catch(t){q.textContent=s.message,n.forEach((t=>t.textContent=""))}}function X(t){O=t,clearInterval(G),clearInterval(z),G=setInterval((()=>o(t)),100),z=setInterval((()=>J(t)),100),Q(f.value,Z(t)),K(t)}K(O),Q(f.value,Z(O)),A.addEventListener("click",(()=>X("ru"))),D.addEventListener("click",(()=>X("eng"))),f.addEventListener("change",(()=>Q(f.value,Z(O)))),h.addEventListener("click",(()=>{K(document.querySelector(".lang__active").textContent.toLowerCase())})),x.addEventListener("click",(()=>U.playAndPause())),w.addEventListener("click",(()=>U.playPrev())),E.addEventListener("click",(()=>U.playNext())),p.addEventListener("click",(()=>H.getSlideNext())),y.addEventListener("click",(()=>H.getSlidePrev())),b.addEventListener("click",(t=>U.getParticularTrack(t))),Y.addEventListener("ended",(()=>U.playNext())),C.addEventListener("click",(()=>U.muteAudioVolume())),I.addEventListener("click",(()=>U.changeProgress())),I.addEventListener("input",(function(){const t=100*this.value/this.max;this.style.background=`linear-gradient(to right, #c5b358 0%, #c5b358 ${t}%, #c4c4c4 ${t}%, #c4c4c4 100%)`})),N.addEventListener("input",(()=>U.changeVolumeDuration())),P.addEventListener("keydown",(function(t){"Enter"==t.code&&function(){if(P.value){$.hidden||($.hidden=!0);let t=new l(P.value);t.createIn(T),R.push(t),P.value=""}}()})),V.addEventListener("click",(function(){M.classList.toggle("settings__panel_show")})),V.addEventListener("click",(function(){this.classList.contains("settings__button_animate")&&this.classList.remove("settings__button_animate"),setTimeout((()=>this.classList.add("settings__button_animate")),0)}));const tt=document.querySelectorAll("input[type=checkbox]");tt.forEach(((t,e)=>{let a=!0;"false"===F[e]&&(a=!1),t.checked=a,t.checked||document.querySelector(`.${B[e]}`).classList.add("hide"),t.addEventListener("change",(()=>document.querySelector(`.${B[e]}`).classList.toggle("hide")))})),j.forEach((t=>{t.addEventListener("click",(function(){document.querySelectorAll(".path-image_active").forEach((t=>t.classList.remove("path-image_active"))),t.classList.add("path-image_active");const e=t.textContent.toLowerCase();e!==W&&(W=e,H=new r(W),H.setBg())})),t.textContent.toLowerCase()===W&&(document.querySelectorAll(".path-image_active").forEach((t=>t.classList.remove("path-image_active"))),t.classList.add("path-image_active"))})),console.log("Благодарю за терпение! \n Self Check - 152.5 балла \n Отзыв по пунктам ТЗ: \n Не выполненные/не засчитанные пункты: \n 1) переводятся настройки приложения, при переключении языка приложения в настройках, язык настроек тоже меняется \n 2) если источником получения фото указан API, в настройках приложения можно указать тег/теги, для которых API будет присылает фото \n Частично выполненные пункты: \n 1) переводится прогноз погоды в т.ч описание погоды и город по умолчанию \n Остальное вроде все выполнено. С ползунком выбора конкретного времени в аудиоплеере могут быть проблемы, но он рабочий :)")})();